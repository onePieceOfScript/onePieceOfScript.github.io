<!DOCTYPE html><html lang="zh-cn"><head><title>Vue源码阅读笔记—— - One Piece Of Script</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><link rel="stylesheet" href="/modest.css"><link rel="stylesheet" href="/style.css"></head><body><div class="container"><div class="side-col"><div class="AuthorInfo"><img class="Avatar" src="https://avatars0.githubusercontent.com/u/17768382?v=3&amp;s=460"><h3>One Piece Of Script</h3><p>兴趣使然的前端工程师</p></div><ul class="linklist"><li><a href="/">home</a></li><li><a href="../">about</a></li></ul></div><div class="main-content page-content"><div class="page-header"><h1 class="title">Vue源码阅读笔记——</h1><ul class="page-meta"><li class="author">Tony Wang</li><li class="date">星期三, 2017 4月 26日 , 下午 3:24</li></ul></div><article class="markdown-body"><p>Vue 初始化项与细节之类。    </p>
<a id="more"></a>
<p>从官网下载下来的源码，分为多个文件夹，其中初始化的入口在src/core/instance/index.js中，其中定义了Vue的构造函数，并对Vue.prototype做了拓展，分别是vue组件初始化的mixin，管理组件state和props中属性的stateMixin，管理事件的eventMixin，管理组件生命周期的lifeCycleMixin，负责渲染的rendermixin。</p>
<p>在Vue的构造函数中调用的Vue.prototype._init方法来自initMixin中对其原型的拓展，该方法做了一系列事情：</p>
<p>解析传入组件的option对象：<br>|- props 可以是数组：数组中对象必须是字符串，type:null<br>         可以是对象：其中元素可以是对象，若不是对象，type:同属性名<br>         normalizeProps 将变量名转化为驼峰式，并组合进对象 key:{type:val}<br>|- directives 若是函数，normalizeDirectives将方法扩展成对象{ bind: def, update: def }<br>|- extends 将option.extend对象或者函数作为父级option与parent合并并返回对象<br>|- mixins  将将option.mixin，如果是vue的原型则，则用mixin.option，如果是别的，用自身，作为父级option与parent合并并返回对象<br>之后，由strats负责合并部分属性，strats对象再config.optionMergeStrategies之中，以下对策略作说明<br>|- strats.data(parentVal: any, childVal: any, vm?: Component): ?Function<br>    该方法返回一个函数，用于返回一个两个方法返回值的合并结果<br>    如果没有定义vm则parentVal和childVal必须是函数，没有子方法，返回父方法，没有父方法，返回子方法。另外父子方法都存在的情况下，合并方式同下<br>    如果定了了vm，若父子为方法，则直接调用方法计算返回值合并，若子为对象，则返回对象，若父为对象，则返回undefined<br>    合并方法：遍历父结果的keys，若子结果中不包含此key，则为子结果添加该<key, value="">，若子结果存在<strong>ob</strong>对象（即监听了），则对此键值对增加反馈属性，即defineReactive方法，<br>    该方法为每一个value加上<strong>ob</strong>属性，<br>|- lifeyclehooks<br>    |  ‘beforeCreate’,<br>    |  ‘created’,<br>    |  ‘beforeMount’,<br>    |  ‘mounted’,<br>    |  ‘beforeUpdate’,<br>    |  ‘updated’,<br>    |  ‘beforeDestroy’,<br>    |  ‘destroyed’,<br>    |  ‘activated’,<br>    |  ‘deactivated’<br>    这些方法都遵从一种合并方式，就是将父组件该方法放在队列前端，子组件的该方法放在后面<br>|- assetTypes<br>    |  ‘component’,<br>    |  ‘directive’,<br>    |  ‘filter’<br>    这些方法遵从一种合并方式，就是子组件覆盖父组件该方法<br>|- watch<br>    同一个值的wacher合并在一个数组中<br>|- props<br>|- methods<br>|- computed<br>    这些会用子组件的覆盖父组件的同名方法或对象，返回一个全新的对象。<br>|- 其他<br>    defaultStrat 如果子组件有定义就使用，否则使用父组件的<br>最终将merge的结果放入vm.$option中</key,></p>
</article></div></div></body></html>