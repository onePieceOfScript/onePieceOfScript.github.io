<!DOCTYPE html><html lang="zh-cn"><head><title>Cross-Browser Cheet Sheet - One Piece Of Script</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><link rel="stylesheet" href="/modest.css"><link rel="stylesheet" href="/style.css"></head><body><div class="container"><div class="side-col"><div class="AuthorInfo"><img class="Avatar" src="https://avatars0.githubusercontent.com/u/17768382?v=3&amp;s=460"><h3>One Piece Of Script</h3><p>Progressive Enhancement</p></div><ul class="linklist"><li><a href="/">home</a></li><li><a href="../">about</a></li></ul></div><div class="main-content page-content"><div class="page-header"><h1 class="title">Cross-Browser Cheet Sheet</h1><ul class="page-meta"><li class="author">Tony Wang</li><li class="date">星期五, 2017 5月 26日 , 下午 4:20</li></ul></div><article class="markdown-body"><p>跨浏览器解决方案 备忘录</p>
<a id="more"></a>
<h2 id="向DOM中注入HTML"><a href="#向DOM中注入HTML" class="headerlink" title="向DOM中注入HTML"></a>向DOM中注入HTML</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 标准化自封闭标签</span></div><div class="line"><span class="keyword">const</span> tags = <span class="regexp">/^(area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> html.replace(<span class="regexp">/^(&lt;(\w+)[^&gt;]*?)\/&gt;/g</span>, (all, front, tag)=&gt;&#123;</div><div class="line">	<span class="built_in">console</span>.log(all, front, tag);</div><div class="line">		<span class="keyword">return</span> tags.test(tag) ? all : front+<span class="string">"&gt;&lt;/"</span>+tag+<span class="string">"&gt;"</span>;</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 提取完整的nodes</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNodes</span>(<span class="params">htmlString, doc, fragment</span>)</span>&#123;</div><div class="line">	<span class="keyword">const</span> map = &#123;</div><div class="line">		<span class="string">"&lt;td"</span>:[<span class="number">3</span>,<span class="string">"&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;"</span>,<span class="string">"&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;"</span>],</div><div class="line">		<span class="string">"&lt;th"</span>:[<span class="number">3</span>,<span class="string">"&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;"</span>,<span class="string">"&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;tr"</span>:[<span class="number">2</span>,<span class="string">"&lt;table&gt;&lt;thead&gt;"</span>,<span class="string">"&lt;/thead&gt;&lt;/table&gt;"</span>],</div><div class="line">		<span class="string">"&lt;option"</span>:[<span class="number">1</span>,<span class="string">"&lt;select multiple&gt;"</span>,<span class="string">"&lt;/select&gt;"</span>], </div><div class="line">		<span class="string">"&lt;optgroup"</span>:[<span class="number">1</span>,<span class="string">"&lt;select multiple&gt;"</span>,<span class="string">"&lt;/select&gt;"</span>], </div><div class="line">		<span class="string">"&lt;legend"</span>:[<span class="number">1</span>,<span class="string">"&lt;fieldset&gt;"</span>,<span class="string">"&lt;/fieldset&gt;"</span>], </div><div class="line">		<span class="string">"&lt;thead"</span>:[<span class="number">1</span>,<span class="string">"&lt;table&gt;"</span>,<span class="string">"&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;tbody"</span>:[<span class="number">1</span>,<span class="string">"&lt;table&gt;"</span>,<span class="string">"&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;tfoot"</span>:[<span class="number">1</span>,<span class="string">"&lt;table&gt;"</span>,<span class="string">"&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;colgroup"</span>:[<span class="number">1</span>,<span class="string">"&lt;table&gt;"</span>,<span class="string">"&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;caption"</span>:[<span class="number">1</span>,<span class="string">"&lt;table&gt;"</span>,<span class="string">"&lt;/table&gt;"</span>], </div><div class="line">		<span class="string">"&lt;col"</span>:[<span class="number">2</span>,<span class="string">"&lt;table&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;colgroup&gt;"</span>, <span class="string">"&lt;/colgroup&gt;&lt;/table&gt;"</span>],</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">const</span> tagName = htmlString.match(<span class="regexp">/&lt;\w+/</span>);</div><div class="line">	<span class="keyword">let</span> mapEntry = tagName ? map[tagName[<span class="number">0</span>]] :<span class="literal">null</span>;</div><div class="line">	<span class="keyword">if</span>(!mapEntry)&#123; mapEntry = [<span class="number">0</span>, <span class="string">" "</span>,<span class="string">" "</span>]; &#125;</div><div class="line">	<span class="keyword">let</span> div = (doc||<span class="built_in">document</span>).createElement(<span class="string">"div"</span>);</div><div class="line">	div.innerHTML = mapEntry[<span class="number">1</span>] + htmlString +  mapEntry[<span class="number">2</span>];</div><div class="line">	<span class="keyword">while</span>(mapEntry[<span class="number">0</span>]--) div = div.lastChild;</div><div class="line">	<span class="keyword">if</span>(fragment) &#123;</div><div class="line">		<span class="keyword">while</span>(div.firstChild)&#123;</div><div class="line">			fragment.appendChild(div.firstChild);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> div.childNodes;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, () =&gt; &#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params">elems, args, callback</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(elems.length)&#123;</div><div class="line">			<span class="keyword">const</span> doc = elems[<span class="number">0</span>].ownDocument || elems[<span class="number">0</span>],</div><div class="line">				  fragment = doc.createDocumentFragment(),</div><div class="line">				  script = getNodes(args, doc, fragment),</div><div class="line">				  first = fragment.firstChild;</div><div class="line">			<span class="keyword">if</span>(first)&#123;</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;elem[i];i++)&#123;</div><div class="line">					callback.call(root(elems[i], first), </div><div class="line">						i &gt; <span class="number">0</span> ? fragment.cloneNode(<span class="literal">true</span>) ; fragment); </div><div class="line">				&#125;</div><div class="line">			&#125;	</div><div class="line"></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">const</span> divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">"div"</span>);</div><div class="line">    insert(divs, <span class="string">"&lt;b&gt;Name:&lt;/b&gt;"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">fragment</span>) </span>&#123;</div><div class="line">      	<span class="keyword">this</span>.appendChild(fragment);</div><div class="line">    &#125;);	</div><div class="line">    insert(divs, <span class="string">"&lt;span&gt;First&lt;/span&gt; &lt;span&gt;Last&lt;/span&gt;"</span>,</div><div class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">fragment</span>) </span>&#123;</div><div class="line">          	<span class="keyword">this</span>.parentNode.insertBefore(fragment, <span class="keyword">this</span>);</div><div class="line">        &#125;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></article></div></div></body></html>